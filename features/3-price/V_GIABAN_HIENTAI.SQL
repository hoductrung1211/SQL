CREATE VIEW V_GIABAN_HIENTAI
AS
    SELECT
        GB.*
    FROM GIABAN GB
        INNER JOIN (
    SELECT
            MAMH,
            MAX(TG_APDUNG) AS TG_APDUNG_GANNHAT
        FROM GIABAN
        WHERE 
        TG_APDUNG < GETDATE()
        GROUP BY MAMH
    ) AS GB_GANNHAT
        ON GB.MAMH = GB_GANNHAT.MAMH
        AND GB.TG_APDUNG = GB_GANNHAT.TG_APDUNG_GANNHAT